<html>
  <head>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {
        'packages':['geochart'],
        'mapsApiKey': 'AIzaSyBArc0dMHQw1ZwpQwMso8IPaT3N6LJVkI4'
      });
      google.charts.setOnLoadCallback(loadCSVData);
      function loadCSVData() {
        fetch('/GenomeInitiativeCountries.csv')
          .then(response => response.text())
          .then(csvText => {
            Papa.parse(csvText, {
              header: true,
              complete: function(results) {
                const extraData = additionaDataDisplay(results.data, results.meta.fields);
                drawRegionsMap(results.data, [results.meta.fields[1],results.meta.fields[3]], extraData);
              }
            });
          });
      }

      // Obtains DataTable for the display menu 
      function additionaDataDisplay(data, fields) {
        var extraDataTable = new google.visualization.DataTable();
        const notStringFields = ["project status (number)"];

        fields.forEach(field => {
          if (notStringFields.includes(field)) {
            extraDataTable.addColumn('number', field)
          } else {
            extraDataTable.addColumn('string', field)
          }
        })
        
        data.forEach(row => {
          extraDataTable.addRow([
            row[fields[0]], 
            row[fields[1]], 
            row[fields[2]], 
            parseFloat(row[fields[3]]),
          ])
        });

        return extraDataTable;
      }

      // Draws the map from just the "ISO" and "project status" columns
      function drawRegionsMap(data, fields, extra) {

        var mapDataArray = [fields.slice(0, 2)];
        var mapDataTable = new google.visualization.DataTable();
        
        mapDataTable.addColumn('string', mapDataArray[0][0]);
        mapDataTable.addColumn('number', mapDataArray[0][1]);
        data.forEach(row => {
          mapDataTable.addRow([row[fields[0]], parseFloat(row[fields[1]])]);
        });


        /**
         * @param selectedItem ...
         * 
         * @returns an array of data about the country of interest
         */
        function getCountryInfo(selectedItem) {
          var country_info = [];
          for (var i=0; i<4; i++) {
            country_info.push(extra.getValue(selectedItem, i));
          }
          return country_info;
        }
        

        var options = {
          colorAxis: {colors: ['#afafaf', '#cc85ad', '#f5b8a3', '#c2ebff', '#d6e085']}, // order: [no, limited scope, H3 Africa, finished, active]
          legend: 'none',
        };

        var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
        chart.draw(mapDataTable, options);

        // event listener for 'select' event
        google.visualization.events.addListener(chart, 'select', function() {
          var selection = chart.getSelection();
          if (selection.length > 0) {
            var selectedItem = selection[0];
            var countryIso = mapDataTable.getValue(selectedItem.row, 0);
            var active = mapDataTable.getValue(selectedItem.row, 1);
            showMenu(getCountryInfo(selectedItem.row));
          }
        });
      }

      function showMenu(specifics) {
        var menu = document.getElementById('info-menu');
        menu.innerHTML = specifics;

        menu.style.display = 'block';
      }
    </script>
  </head>
  
  <body>
    <div id="regions_div"></div>
    <div id=info-menu class="info-menu w3-third">
      <h2>National Initiative</h2>
      <table class="w3-table w3-striped w3-bordered w3-border">
        <thead class="w3-teal"><th style="width:30%"></th><th></th></thead>
        <tr><td style="width:30%"></td><td></td></tr>
        <tr><td></td><td></td></tr>
        <tr><td></td><td></td></tr>
        <tr><td></td><td></td></tr>
      </table>
      

    </div>
    
    <div class="legend">
      <h3>National Initiative Status:</h3>
      <ul>
        <li>
          <span class="legend-colorBox" style="background-color: #d6e085;"></span>
          <span class="legend-text">Active</span>
        </li>
        <li>
          <span class="legend-colorBox" style="background-color: #c2ebff;"></span>
          <span class="legend-text">Finished</span>
        </li>
        <li>
          <span class="legend-colorBox" style="background-color: #f5b8a3;"></span>
          <span class="legend-text">H3 Africa</span>
        </li>
        <li>
          <span class="legend-colorBox" style="background-color: #cc85ad;"></span>
          <span class="legend-text">Limited Scope</span>
        </li>
        <li>
          <span class="legend-colorBox" style="background-color: #afafaf;"></span>
          <span class="legend-text">None</span>
        </li>
      </ul>
    </div>

    <div class="dot" id="usa-dot" style="top: 500px; left: 350px;"></div>
    <div class="dot" id="canada-dot" style="top: 390px; left: 320px;"></div>
    <div class="dot" id="brazil-dot" style="top: 720px; left: 560px;"></div>
    <div class="dot" id="uruguay-dot" style="top: 818px; left: 534px;"></div>
    <div class="dot" id="finland-dot" style="top: 340px; left: 870px;"></div>
    <div class="dot" id="ireland-dot" style="top: 414px; left: 732px;"></div>
    <div class="dot" id="egypt-dot" style="top: 558px; left: 886px;"></div>
    <div class="dot" id="saudi-dot" style="top: 568px; left: 946px;"></div>
    <div class="dot" id="china-dot" style="top: 525px; left: 1186px;"></div>
    <div class="dot" id="skorea-dot" style="top: 516px; left: 1294px;"></div>
    <div class="dot" id="australia-dot" style="top: 780px; left: 1320px;"></div>
    <div class="dot" id="nz-dot" style="top: 870px; left: 1472px;"></div>


    <div class="notable-initiatives">
      <h3>Notable Initiatives:</h3>
      <div class="columns">
        <div class="column">
          <h4>North America</h4>
          <ul>
            <li>
              <span class="legend-colorBox" id="usa"></span>
              <span class="country-info">
                <span class="legend-text">USA</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>1 M</span>
                </span>
              </span>
            </li>
            <li>
              <span class="legend-colorBox" id="canada"></span>
              <span class="country-info">
                <span class="legend-text">Canada</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>130 K</span>
                </span>
              </span>
            </li>
          </ul>
          <h4>South America</h4>
          <ul>
            <li>
              <span class="legend-colorBox" id="brazil"></span>
              <span class="country-info">
                <span class="legend-text">Brazil</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>15 K</span>
                </span>
              </span>
            </li>
            <li>
              <span class="legend-colorBox" id="uruguay"></span>
              <span class="country-info">
                <span class="legend-text">Uruguay</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>0.85 K</span>
                </span>
              </span>
            </li>
          </ul>
        </div>
        <div class="column">
          <h4>Europe</h4>
          <ul>
            <li>
              <span class="legend-colorBox" id="finland"></span>
              <span class="country-info">
                <span class="legend-text">Finland</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>500 K</span>
                </span>
              </span>
            </li>
            <li>
              <span class="legend-colorBox" id="ireland"></span>
              <span class="country-info">
                <span class="legend-text">Ireland</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>400 K</span>
                </span>
              </span>
            </li>
          </ul>
          <h4>Africa / Middle East</h4>
          <ul>
            <li>
              <span class="legend-colorBox" id="egypt"></span>
              <span class="country-info">
                <span class="legend-text">Egypt</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>0.1 K</span>
                </span>
              </span>
            </li>
            <li>
              <span class="legend-colorBox" id="saudi"></span>
              <span class="country-info">
                <span class="legend-text">Saudi Arabia</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>100 K</span>
                </span>
              </span>
            </li>
          </ul>
        </div>
        <div class="column">
          <h4>Asia</h4>
          <ul>
            <li>
              <span class="legend-colorBox" id="china"></span>
              <span class="country-info">
                <span class="legend-text">China</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>100 M</span>
                </span>
              </span>
            </li>
            <li>
              <span class="legend-colorBox" id="skorea"></span>
              <span class="country-info">
                <span class="legend-text">South Korea</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>50 M</span>
                </span>
              </span>
            </li>
            
          </ul>
          
          <h4>Oceania</h4>
          <ul>
            <li>
              <span class="legend-colorBox" id="australia"></span>
              <span class="country-info">
                <span class="legend-text">Australia</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>25 K</span>
                </span>
              </span>
            </li>
            <li>
              <span class="legend-colorBox" id="nz"></span>
              <span class="country-info">
                <span class="legend-text">New Zealand</span>
                <span class="info-right">
                  <i class="fas fa-dna"></i>
                  <span>0.6 K</span>
                </span>
              </span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </body>
  <style>
    .legend {
      position: sticky;
      bottom: 10px;
      left: 10px;
      max-width: fit-content;
      border: 1px solid black;
      padding: 10px;
    }
    h3 {
      margin-top: 0px;
    }
    ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }
    li {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }
    .legend-text {
      margin-left: 10px;
    }
    .legend-colorBox {
      height: 2rem;
      width: 2rem;
      border: 1pt solid black;
      display: inline-block;
    }
    .info-menu {
      display: none; 
      position: absolute; 
      top: 10px;
      left: 10px;
      background-color: white;
      border: 1px solid black;
      padding: 10px;
    }


    .notable-initiatives{
      display: flex;
      flex-wrap: wrap;
      position: sticky;
      bottom: 10px;
      left: 630px;
      max-width: fit-content;
      border: 1px solid black;
      padding: 10px;
    }
    .notable-initiatives .legend-colorBox{
      width: 1rem;
      height: 1rem;
      display: inline-block;
      border-radius: 50%;
    }
    .columns {
      display: flex;
      width: 100%;
    }
    .column {
      flex: 1;
      padding: 5px;
    }
    .column h4 {
    font-size: 1rem;
    font-weight: bold;
    margin: 5px 0;
    }
    .country-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 85%;
    }
    .country-info .info-right {
      display: flex;
      align-items: center;
      margin-left: auto;
    }
    .country-info .info-right .fa-dna {
      margin-right: 5px;
    }

    
    #usa {
      width: 20px;
      height: 20px;
      background-color: #3C3B6E;
      border: 3px solid #B22234;
    }
    #canada {
      width: 20px;
      height: 20px;
      background-color: #FF0000;
      border: 3px solid black;
    }
    #finland {
      width: 20px;
      height: 20px;
      background-color: #FFFFFF;
      border: 3px solid #003580;
    }
    #ireland {
      width: 20px;
      height: 20px;
      background-color: #169B62;
      border: 2px solid #FF883E;
    }
    #egypt {
      width: 20px;
      height: 20px;
      background-color: #000000;
      border: 3px solid #CE1126;
    }
    #saudi {
      width: 20px;
      height: 20px;
      background-color: #FFFFFF;
      border: 3px solid #008753;
    }
    #china {
      width: 20px;
      height: 20px;
      background-color: #FFDE00;
      border: 3px solid #FF0000;
    }
    #skorea {
      width: 20px;
      height: 20px;
      background-color: #FFFFFF;
      border: 3px solid #BC002D;
    }
    #brazil {
      width: 20px;
      height: 20px;
      background-color: #FFDF00;
      border: 3px solid #009C3B;
    }
    #uruguay {
      width: 20px;
      height: 20px;
      background-color: #3E6BB7;
      border: 3px solid #FCD116;
    }
    #australia {
      width: 20px;
      height: 20px;
      background-color: #FF0000 ;
      border: 3px solid #00247D;
    }
    #nz {
      width: 20px;
      height: 20px;
      background-color: #00247D;
      border: 3px solid #CC142B;
    }

    .dot {
      border-radius: 50%;
      position: absolute;
    }
    #usa-dot {
      width: 15px;
      height: 15px;
      background-color: #3C3B6E;
      border: 2px solid #B22234;
    }
    #canada-dot {
      width: 15px;
      height: 15px;
      background-color: #FF0000;
      border: 2px solid black;
    }
    #finland-dot {
      width: 15px;
      height: 15px;
      background-color: #FFFFFF;
      border: 3px solid #003580;
    }
    #ireland-dot {
      width: 15px;
      height: 15px;
      background-color: #169B62;
      border: 2px solid #FF883E;
    }
    #egypt-dot {
      width: 15px;
      height: 15px;
      background-color: #000000;
      border: 2px solid #CE1126;
    }
    #saudi-dot {
      width: 15px;
      height: 15px;
      background-color: #FFFFFF;
      border: 3px solid #006C35;
    }
    #china-dot {
      width: 15px;
      height: 15px;
      background-color: #FFDE00;
      border: 3px solid #FF0000;
    }
    #skorea-dot {
      width: 15px;
      height: 15px;
      background-color: #FFFFFF;
      border: 3px solid #C60C30;
    }
    #brazil-dot {
      width: 15px;
      height: 15px;
      background-color: #FFDF00;
      border: 3px solid #009C3B;
    }
    #uruguay-dot {
      width: 15px;
      height: 15px;
      background-color: #3E6BB7;
      border: 3px solid #FCD116;
    }
    #australia-dot {
      width: 15px;
      height: 15px;
      background-color: #FF0000;
      border: 3px solid #00247D;
    }
    #nz-dot {
      width: 15px;
      height: 15px;
      background-color: #00247D;
      border: 3px solid #CC142B;
    }

  
  </style>
</html>